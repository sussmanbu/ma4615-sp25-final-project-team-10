<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="A 538/Upshot style article about the data.">

<title>Big Picture – MA [46]15 Final Project Team Mango</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MA [46]15 Final Project Team Mango</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./big_picture.html" aria-current="page"> 
<span class="menu-text">Big Picture</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./analysis.html"> 
<span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html"> 
<span class="menu-text">Data</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#behind-the-exoneration-surge-a-racial-reckoning" id="toc-behind-the-exoneration-surge-a-racial-reckoning" class="nav-link active" data-scroll-target="#behind-the-exoneration-surge-a-racial-reckoning">Behind the Exoneration Surge: A Racial Reckoning</a>
  <ul class="collapse">
  <li><a href="#figure-1-exonerations-by-crime-type" id="toc-figure-1-exonerations-by-crime-type" class="nav-link" data-scroll-target="#figure-1-exonerations-by-crime-type">Figure 1: Exonerations by Crime Type</a></li>
  <li><a href="#figure-2-age-distribution-of-exonerees" id="toc-figure-2-age-distribution-of-exonerees" class="nav-link" data-scroll-target="#figure-2-age-distribution-of-exonerees">Figure 2: Age Distribution of Exonerees</a></li>
  <li><a href="#figure-3-racial-disparities-in-exonerations-cook-county-only" id="toc-figure-3-racial-disparities-in-exonerations-cook-county-only" class="nav-link" data-scroll-target="#figure-3-racial-disparities-in-exonerations-cook-county-only">Figure 3: Racial Disparities in Exonerations (Cook County Only)</a></li>
  <li><a href="#figure-4-racial-proportion-of-exonerations-by-violent-crime-in-cook-county" id="toc-figure-4-racial-proportion-of-exonerations-by-violent-crime-in-cook-county" class="nav-link" data-scroll-target="#figure-4-racial-proportion-of-exonerations-by-violent-crime-in-cook-county">Figure 4: Racial Proportion of Exonerations by Violent Crime in Cook County</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Big Picture</h1>
</div>

<div>
  <div class="description">
    A 538/Upshot style article about the data.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><img src="images/The_Big_Picture_2.jpeg" class="img-fluid"></p>
<p>This comes from the file <code>big_picture.qmd</code>.</p>
<hr>
<section id="behind-the-exoneration-surge-a-racial-reckoning" class="level2">
<h2 class="anchored" data-anchor-id="behind-the-exoneration-surge-a-racial-reckoning">Behind the Exoneration Surge: A Racial Reckoning</h2>
<p>Every year, thousands of criminal cases play out in Cook County courts, ranging from non-violent drug offenses to the most serious charges of murder and assault. Buried within these prosecutions are two stories: the raw volume of reported crimes and the far smaller—but telling—number of cases later overturned as wrongful convictions. In this project, we bring together two complementary datasets to reveal a stark narrative of justice gone awry.</p>
<p>The first is the National Registry of Exonerations, a comprehensive record of every documented case in which a convicted individual was fully cleared by DNA evidence, official review boards, or other post-conviction mechanisms. It shows us not only which crimes most frequently result in exonerations, but also who those exonerees are—by age, race, and sex.</p>
<p>The second is the City of Chicago’s Crimes dataset, filtered here to Cook County. It catalogues every reported offense—its type, date, and location—giving us the backdrop of how many times each crime is prosecuted.</p>
<p>By placing these two datasets side by side, we can gain valuable insights.</p>
<p><strong>Thesis Statement:</strong></p>
<p>In Cook County, Black defendants are exonerated at far higher rates than white defendants—especially for violent crimes—revealing deep racial disparities in who is wrongly convicted and later cleared. This page explores a troubling pattern in Cook County’s justice system: violent crimes are more likely to lead to exoneration than non-violent crimes, and Black defendants are exonerated at significantly higher rates than white defendants—often 1.5 to 2 times as often. That doesn’t mean Black people are more likely to be innocent. It means they were more likely to be wrongly convicted in the first place.</p>
<p><a href="https://zuizzms.shinyapps.io/dataset/" target="_blank">Explore the interactive dashboard here.</a></p>
<p>When you land on our interactive dashboard, you’ll see two tabs along the top: Crime Trend and Exoneration Rates. Both are designed to put our central thesis—violent crimes are overturned more often than non-violent ones, and Black defendants face exoneration rates 1.5–2× those of white defendants—in your hands.</p>
<p><strong>Crime Trend</strong></p>
<p>Click on the Crime Trend tab, then use the dropdown menu to pick any offense—say, HOMICIDE or THEFT—and slide the year‐range selector to focus on exactly the period you care about. Immediately you’ll see a bar chart of “Number of … Cases by Year.” This lets you answer questions like:</p>
<ul>
<li><p>Did reported homicides peak in 2016 or 2017?</p></li>
<li><p>Has theft in Cook County been steadily rising, falling, or bouncing around since 2010?</p></li>
</ul>
<p>By toggling between violent (e.g.&nbsp;ASSAULT, ROBBERY) and non-violent categories (e.g.&nbsp;THEFT, NARCOTICS), you can compare their raw volumes and get a sense of the denominator for any exoneration rate.</p>
<p><strong>Exoneration Rates (Murder)</strong></p>
<p>Switch to the Exoneration Rates tab, where the default filter is set to Murder—our most common exonerated offense. What you’ll see is a multi-colored line chart of annual Cook County exonerations for murder, with one line each for Black, Hispanic, and White defendants (other races appear too sparsely to show here).</p>
<p>From 2010 through about 2016, Black defendants experienced roughly 4–6 murder exonerations each year—consistently higher than any other group.</p>
<p>White defendants average only about 1–2 exonerations per year, a fraction of the Black count.</p>
<p>Beginning around 2017, Hispanic exonerations start to rise: they briefly match Black numbers in 2017, dip back, and then spike to 20 exonerations in 2021.</p>
<p>Because you can again adjust the year slider, it’s easy to isolate the COVID years (2020–21) when exonerations peaked for murder across all groups, or zoom out to see the longer trend since 2010.</p>
<p><strong>How This Supports Our Thesis</strong></p>
<p>Violent vs.&nbsp;non-violent: By comparing the heights of bars in the Crime Trend tab for a violent crime like Murder against a non-violent crime like Theft, you see that violent crimes are prosecuted in smaller absolute numbers—but the exoneration line in the second tab still towers over the non-violent exoneration lines (if you switch filter), demonstrating a higher overturn rate per conviction.</p>
<p>Racial disparity: In the Murder chart, the Black line sits 1.5–2× higher than the White line for every year you choose—exactly the gap our thesis predicts. Even during the 2021 spike, Hispanic exonerations surge, but Black exonerations remain elevated relative to White, underscoring persistent racial imbalances.</p>
<p>By flipping between these two views—raw crime counts and race-stratified exonerations for murder—you can see, year by year, that our justice system both prosecutes violent crimes rigorously and yet exonerates them disproportionately, especially for Black defendants. That dynamic visual story is exactly what our thesis set out to prove.</p>
<p>By comparing exoneration rates by crime type and race over time, we uncover how systemic bias can shape not just who is punished, but also who is eventually vindicated. These disparities don’t just reflect flaws in individual cases—they reveal larger patterns of racial injustice built into the system of arrest, prosecution, and review.</p>
<section id="figure-1-exonerations-by-crime-type" class="level3">
<h3 class="anchored" data-anchor-id="figure-1-exonerations-by-crime-type">Figure 1: Exonerations by Crime Type</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="big_picture_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This bar chart shows that two of the most serious charges—Drug Possession or Sale and Murder—far outpace every other crime in the number of exonerations. In plain terms, the very offenses that carry the highest stakes and longest sentences also produce the most wrongful convictions. Because these heavy‐penalty crimes are so error-prone, the data tell us that violent and high-impact cases are disproportionately exonerated. That directly supports the first part of our thesis: violent offenses (like murder) are overturned at a higher rate than non-violent ones, even though they represent a smaller slice of total criminal filings. These aren’t minor slip-ups—they’re signs of deeper systemic failures. Murder convictions in particular often come from high-pressure investigations where mistakes, misconduct, or bias are more likely to occur.</p>
</section>
<section id="figure-2-age-distribution-of-exonerees" class="level3">
<h3 class="anchored" data-anchor-id="figure-2-age-distribution-of-exonerees">Figure 2: Age Distribution of Exonerees</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="big_picture_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here we see that a huge majority of exonerees were between 18 and 30 years old at the time of conviction. This suggests that young adults—often newly navigating the criminal justice system—are especially vulnerable to mistakes, poor legal counsel, or coercion. While this chart doesn’t show race or crime type, it underscores a broader pattern: the system’s most severe failures tend to happen to young defendants, who are more likely to be charged with serious crimes and, as Figure 1 shows, later exonerated. Youth are more susceptible to false confessions, legal pressure, and poor representation. These aren’t just numbers—they reflect whose lives were most disrupted.</p>
</section>
<section id="figure-3-racial-disparities-in-exonerations-cook-county-only" class="level3">
<h3 class="anchored" data-anchor-id="figure-3-racial-disparities-in-exonerations-cook-county-only">Figure 3: Racial Disparities in Exonerations (Cook County Only)</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="big_picture_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Interpretation: Black defendants dominate Cook County’s exoneration counts. That doesn’t mean they were treated fairly—it means they were more likely to be wrongfully convicted in the first place. They account for roughly 370 exonerations versus about 70 for Hispanics and only 30 for Whites. This stark imbalance demonstrates the second half of our thesis: Black defendants experience exoneration rates 1.5–2× those of White defendants—not because they are more innocent, but because they were more likely to be wrongfully convicted in the first place. The system isn’t correcting the error; it’s revealing how often it targeted the same group.</p>
</section>
<section id="figure-4-racial-proportion-of-exonerations-by-violent-crime-in-cook-county" class="level3">
<h3 class="anchored" data-anchor-id="figure-4-racial-proportion-of-exonerations-by-violent-crime-in-cook-county">Figure 4: Racial Proportion of Exonerations by Violent Crime in Cook County</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="big_picture_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This chart illustrates the racial breakdown of exonerations across four major categories of violent crimes in Cook County: Murder, Robbery, Assault, and Sexual Assault. In each category, Black defendants make up the overwhelming majority of those exonerated. In Robbery and Sexual Assault cases in particular, Black exonerees account for nearly all recorded exonerations.</p>
<p>This pattern does not reflect who commits crimes—it reveals who is more likely to be wrongfully convicted. The fact that Black defendants are exonerated at such disproportionate rates suggests that systemic bias operates not just at the point of conviction, but in the very mechanisms that later uncover and correct injustice. In other words, exoneration doesn’t prove the system worked—it shows where it broke.</p>
<p><strong>Summary &amp; Reflection:</strong></p>
<p>The thesis was simple: In Cook County, Black defendants are exonerated at much higher rates than white defendants—especially for violent crimes. Our figures confirm this, painting a portrait of a justice system that leans harder on Black communities and reserves its rare corrections for only the most severe cases.</p>
<p>Our goal wasn’t just to show who gets exonerated—but to ask why they needed to be in the first place. These aren’t isolated errors. They are symptoms of a system that has long criminalized race and poverty more than it has pursued truth.</p>
<p>Creativity:</p>
<p>When we think of exonerations, we often picture a broken system finally setting things right. But in Cook County, the patterns of who gets exonerated tell a more disturbing story—not just about justice delayed, but justice distorted.</p>
<p>Start with the crime. Violent offenses like murder and assault are more likely to be overturned than non-violent ones. That might sound logical—after all, they get more scrutiny. But that also means wrongful convictions for the most serious charges may be shockingly common.</p>
<p>Then look at race. Black defendants are exonerated far more often than white defendants—not because they’re committing more crimes, but because they’re more likely to be wrongly accused, convicted, and imprisoned. These aren’t isolated mistakes. They’re signs of a system that historically leans harder on Black communities at every stage—from arrest to trial to sentencing.</p>
<p>And then, the final twist: the same system that over-polices and over-convicts Black defendants is the one that only sometimes gets around to clearing them. The exoneration is not proof that the system worked—it’s proof that it failed.</p>
<p>Each of the lines on our graph tells part of that story. They rise when justice catches up—but they exist in the first place because injustice got there first.</p>
<p>Interactive component:</p>
<p>Use the “Crime Trend” tab to see how the number of reported crimes in Cook County has changed over time. You can filter by specific offense types (like Theft or Assault) and focus on particular time periods using the slider. This gives important context for understanding the scale and types of criminal charges pursued in the county each year.</p>
<p>Then, switch to the “Exoneration Rates” tab to explore how often people were later cleared of those crimes—broken down by race. You’ll see that Black defendants are consistently exonerated more often than any other group, especially for violent crimes. But that doesn’t mean they were treated fairly. It means they were more likely to be wrongly convicted in the first place.</p>
<p>By moving between the two tabs, you can trace the full arc of Cook County’s criminal justice system—from who gets charged to who ultimately gets a second chance—and who doesn’t.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/sussmanbu\.github\.io\/ma4615-sp25-final-project-team-10\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>